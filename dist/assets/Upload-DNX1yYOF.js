import{b as L,r as c,j as e,a1 as M,a2 as z,k as f,z as D,I as P,J as A,t as I,K as i,O as E}from"./vendor-react-DTJB9r93.js";import{u as U}from"./index-ba0X72c2.js";import"./vendor-BigPqmVK.js";import"./vendor-firebase-B7eFefMy.js";function $(){const p=L(),{semesters:u,subjects:d,addMaterial:N,isAdmin:o,materials:v,user:h,approveMaterial:y,rejectMaterial:w}=U(),[x,b]=c.useState("upload"),j=v.filter(s=>s.status==="Pending");if(c.useEffect(()=>{o===!1&&p("/")},[o,p]),o===!1)return null;const k=c.useMemo(()=>["Notes","Practicals","IMP","Assignment"],[]),[t,g]=c.useState({title:"",semester:"",type:"Notes",subject:"",driveLink:"",uploadDate:new Date().toLocaleDateString()}),S=c.useMemo(()=>d.filter(s=>Number(s.semId)===Number(t.semester)),[d,t.semester]),m=t.title&&t.semester&&t.subject&&t.driveLink;function n(s){return l=>g(r=>({...r,[s]:l.target.value}))}async function C(s){if(s.preventDefault(),!t.title||!t.subject||!t.driveLink){i.error("Please fill in all required fields");return}try{const l=await N({title:t.title,semId:t.semester,subjectId:t.subject,type:t.type,link:t.driveLink,uploadedBy:h?.displayName||h?.email.split("@")[0]||"Student"});if(l.success)g(r=>({...r,title:"",driveLink:"",uploadDate:new Date().toLocaleDateString()})),i.success("Material submitted successfully! Pending approval.");else{const r=l.error||"An unknown error occurred during submission";i.error("Error submitting material: "+r)}}catch(l){console.error("Upload Error Details:",l);const r=l?.message||l?.toString()||"An unknown error occurred";i.error("Error submitting material: "+r)}}return e.jsxs("div",{className:"p-5 pt-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Upload"}),e.jsx("p",{className:"text-white/55 text-xs mt-1",children:"Share notes, practicals, important materials, and assignments."})]}),e.jsxs("div",{className:"flex w-full bg-zinc-900 rounded-lg p-1 mb-6",children:[e.jsx("button",{type:"button",onClick:()=>b("upload"),className:`flex-1 py-2 text-center font-bold transition-colors ${x==="upload"?"bg-yellow-400 text-black rounded-md":"text-white/70"}`,children:"Upload"}),e.jsx("button",{type:"button",onClick:()=>b("pending_admin"),className:`flex-1 py-2 text-center font-bold transition-colors ${x==="pending_admin"?"bg-yellow-400 text-black rounded-md":"text-white/70"}`,children:"Pending (Admin)"})]}),x==="upload"?e.jsxs("form",{className:"glass-card p-4",onSubmit:C,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-white/50 uppercase text-[10px] tracking-widest font-bold",children:"Publish Material"}),e.jsx("div",{className:"text-[12px] text-white/70 mt-2",children:"Fill in the details exactly so students can find it easily."})]}),e.jsxs("label",{className:"block mb-4",children:[e.jsx("div",{className:"text-[11px] font-bold text-white/70 mb-2",children:"Title"}),e.jsx("input",{value:t.title,onChange:n("title"),placeholder:"e.g., Unit 1 Notes",className:"w-full glass-card px-4 py-3 text-sm outline-hidden placeholder:text-white/35",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block mb-4",children:[e.jsx("div",{className:"text-[11px] font-bold text-white/70 mb-2",children:"Semester *"}),e.jsxs("select",{value:t.semester,onChange:n("semester"),className:"w-full glass-card px-4 py-3 text-sm outline-hidden",required:!0,children:[e.jsx("option",{value:"",className:"bg-[#0a0a0a]",children:"Select Semester"}),u.map(s=>e.jsx("option",{value:s.id,className:"bg-[#0a0a0a]",children:s.name},s.id))]})]}),e.jsxs("label",{className:"block mb-4",children:[e.jsx("div",{className:"text-[11px] font-bold text-white/70 mb-2",children:"Type *"}),e.jsx("select",{value:t.type,onChange:n("type"),className:"w-full glass-card px-4 py-3 text-sm outline-hidden",required:!0,children:k.map(s=>e.jsx("option",{value:s,className:"bg-[#0a0a0a]",children:s},s))})]})]}),e.jsxs("label",{className:"block mb-4",children:[e.jsx("div",{className:"text-[11px] font-bold text-white/70 mb-2",children:"Subject *"}),e.jsxs("select",{value:t.subject,onChange:n("subject"),className:`w-full glass-card px-4 py-3 text-sm outline-hidden ${t.semester?"":"opacity-50"}`,required:!0,disabled:!t.semester,children:[e.jsx("option",{value:"",className:"bg-[#0a0a0a]",children:t.semester?"Select subject...":"Select semester first"}),S.map(s=>e.jsxs("option",{value:s.id,className:"bg-[#0a0a0a]",children:[s.name," (Sem ",s.semId,")"]},s.id))]}),!t.semester&&e.jsx("div",{className:"text-[10px] text-amber-400 mt-1",children:"Please select a semester first"})]}),e.jsxs("label",{className:"block mb-4",children:[e.jsx("div",{className:"text-[11px] font-bold text-white/70 mb-2",children:"Google Drive Link *"}),e.jsxs("div",{className:"glass-card px-4 py-3 flex items-center gap-3",children:[e.jsx(M,{size:18,className:"text-white/55"}),e.jsx("input",{value:t.driveLink,onChange:n("driveLink"),placeholder:"https://drive.google.com/...",className:"w-full bg-transparent text-sm outline-hidden placeholder:text-white/35",required:!0})]})]}),e.jsxs("label",{className:"block mb-5",children:[e.jsx("div",{className:"text-[11px] font-bold text-white/70 mb-2",children:"Upload Date"}),e.jsxs("div",{className:"glass-card px-4 py-3 flex items-center gap-3 bg-zinc-900/50",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-white/55",children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",x2:"16",y1:"2",y2:"6"}),e.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"6"}),e.jsx("line",{x1:"3",x2:"21",y1:"10",y2:"10"})]}),e.jsx("input",{value:t.uploadDate,readOnly:!0,className:"w-full bg-transparent text-sm outline-hidden text-zinc-400"})]})]}),e.jsxs("button",{type:"submit",className:`w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${m?"btn-primary":"bg-white/10 text-white/30 cursor-not-allowed"}`,disabled:!m,children:[m?"Publish Material":"Fill all required fields",e.jsx(z,{size:18})]})]}):e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-white/50 uppercase text-[10px] tracking-widest font-bold",children:"Pending Materials"}),e.jsx("div",{className:"text-[12px] text-white/70 mt-2",children:"Materials awaiting approval."})]}),j.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:j.map(s=>{const l=d.find(a=>a.id===s.subjectId),r=u.find(a=>a.id===s.semId);return e.jsx("div",{className:"glass-card p-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5",children:s.type==="Notes"?e.jsx(f,{className:"text-blue-400",size:16}):s.type==="Practicals"?e.jsx(D,{className:"text-green-400",size:16}):s.type==="IMP"?e.jsx(P,{className:"text-yellow-400",size:16}):s.type==="Assignment"?e.jsx(A,{className:"text-purple-400",size:16}):e.jsx(f,{className:"text-amber-400",size:16})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white/90 text-sm",children:s.title}),e.jsxs("div",{className:"text-xs text-white/50 mt-1",children:[r?.name," • ",l?.name," • ",s.type]}),e.jsxs("div",{className:"text-xs text-white/40 mt-1",children:["Uploaded by ",s.uploadedBy," • ",new Date(s.date).toLocaleDateString()]})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:async()=>{try{const a=await y(s.id);a.success?i.success("Material approved successfully!"):i.error(a.error||"Failed to approve material")}catch(a){i.error("Error approving material: "+a.message)}},className:"flex items-center gap-1 px-3 py-1.5 rounded-xl bg-emerald-500/15 border border-emerald-500/25 text-emerald-200 font-bold hover:bg-emerald-500/20 transition-colors text-xs",children:[e.jsx(I,{size:14}),"Approve"]}),e.jsxs("button",{type:"button",onClick:async()=>{try{const a=await w(s.id);a.success?i.success("Material rejected successfully!"):i.error(a.error||"Failed to reject material")}catch(a){i.error("Error rejecting material: "+a.message)}},className:"flex items-center gap-1 px-3 py-1.5 rounded-xl bg-rose-500/10 border border-rose-500/20 text-rose-200 font-bold hover:bg-rose-500/15 transition-colors text-xs",children:[e.jsx(E,{size:14}),"Reject"]})]})]})},s.id)})}):e.jsxs("div",{className:"text-center py-8 text-white/40",children:[e.jsx("p",{children:"No pending materials"}),e.jsx("p",{className:"text-sm mt-1",children:"All materials have been approved!"})]})]})]})}export{$ as default};
