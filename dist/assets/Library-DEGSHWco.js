import{r as a,j as e,h as F,A as T,i as M,k as D}from"./vendor-react-C85kPXhq.js";import{u as I,a as B}from"./index-CM_2e7_B.js";import{M as E}from"./MaterialCard-Bthj04Gv.js";import"./vendor-BigPqmVK.js";import"./vendor-firebase-B7eFefMy.js";function q(){const{subjects:L,semesters:p,getSubjectById:n,getSemesterById:R}=I(),{libraryMaterials:c,fetchLibraryData:x,isLibraryLoaded:b}=B(),[i,f]=a.useState(""),[d,g]=a.useState(""),[o,j]=a.useState(""),[r,v]=a.useState("title"),[u,h]=a.useState(!1),[$,N]=a.useState(!1);a.useEffect(()=>{x()},[x]),a.useEffect(()=>{const s=setTimeout(()=>{N(!0)},10);return()=>clearTimeout(s)},[]);const w=()=>e.jsx("div",{className:"glass-card p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-zinc-800 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2 mb-1"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-2/3"})]})]})}),y=s=>{if(!s)return s;if(s.includes("drive.google.com/file/d/")){const t=s.match(/\/file\/d\/([^\/]+)/);if(t&&t[1])return`https://drive.google.com/uc?export=download&id=${t[1]}&confirm=t`}else if(s.includes("drive.google.com/open?id=")){const l=new URL(s).searchParams.get("id");if(l)return`https://drive.google.com/uc?export=download&id=${l}&confirm=t`}else if(s.includes("/d/")&&s.includes("/view")){const t=s.match(/\/d\/([^\/]+)\/view/);if(t&&t[1])return`https://drive.google.com/uc?export=download&id=${t[1]}&confirm=t`}return s},S=a.useMemo(()=>{const s=new Set;return c.forEach(t=>{t.type&&s.add(t.type)}),Array.from(s).sort()},[c]),m=a.useMemo(()=>{let s=c.filter(t=>{const l=!i||t.title.toLowerCase().includes(i.toLowerCase())||n(t.subjectId)?.name.toLowerCase().includes(i.toLowerCase()),z=!d||t.semId===d||d==="all",C=!o||t.type.toLowerCase()===o.toLowerCase()||o==="all",A=t.status==="Approved";return l&&z&&C&&A});return s.sort((t,l)=>r==="newest"?l.createdAt?.seconds-t.createdAt?.seconds:r==="oldest"?t.createdAt?.seconds-l.createdAt?.seconds:r==="title"?t.title.localeCompare(l.title):0),s},[c,i,d,o,n,r]);return b?e.jsxs("div",{className:"p-5 pt-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-white to-white/80 bg-clip-text text-transparent",children:"Study Library"}),e.jsx("p",{className:"text-white/55 text-xs mt-1",children:"Browse all notes, practicals, important materials, and assignments"})]}),e.jsx("div",{className:"glass-card p-4 mb-4 relative z-50",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(F,{size:16,className:"text-white/50"})}),e.jsx("input",{type:"text",value:i,onChange:s=>f(s.target.value),placeholder:"Search materials...",className:"w-full glass-card pl-10 pr-4 py-2 rounded-xl border border-white/10 bg-white/5 text-white placeholder:text-white/30 focus:border-[#FFD700] focus:outline-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>h(!u),className:"p-3 bg-zinc-800/50 rounded-xl border border-zinc-700/50 text-zinc-400 hover:text-white transition-colors","aria-label":"Sort materials",title:"Sort materials",children:e.jsx(T,{size:18})}),u&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-[#09090b] border border-zinc-800 rounded-xl shadow-2xl z-50 py-1 overflow-hidden",children:e.jsx("div",{className:"py-2",children:[{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"}].map(s=>e.jsxs("button",{type:"button",onClick:()=>{v(s.value),h(!1)},className:`w-full px-4 py-3 text-left text-sm flex items-center justify-between hover:bg-zinc-800 transition-colors ${r===s.value?"text-[#FFD700] font-bold bg-zinc-800":"text-zinc-200"}`,children:[s.label,r===s.value&&e.jsx(M,{size:16})]},s.value))})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{value:d,onChange:s=>g(s.target.value),className:"glass-card px-3 py-2 rounded-xl border border-white/10 bg-white/5 text-white focus:border-[#FFD700] focus:outline-none text-sm",children:[e.jsx("option",{value:"all",className:"bg-[#0a0a0a]",children:"All Sem"}),p.map(s=>e.jsx("option",{value:s.id,className:"bg-[#0a0a0a]",children:s.name.replace("Semester ","Sem ")},s.id))]}),e.jsxs("select",{value:o,onChange:s=>j(s.target.value),className:"glass-card px-3 py-2 rounded-xl border border-white/10 bg-white/5 text-white focus:border-[#FFD700] focus:outline-none text-sm",children:[e.jsx("option",{value:"all",className:"bg-[#0a0a0a]",children:"All Types"}),S.map(s=>e.jsx("option",{value:s,className:"bg-[#0a0a0a]",children:s},s))]})]})]})}),e.jsx("div",{className:"mb-2 flex items-center justify-between",children:e.jsxs("p",{className:"text-white/70 text-xs",children:["Showing ",e.jsx("span",{className:"font-bold text-[#FFD700]",children:m.length})," of ",c.length," approved materials"]})}),e.jsx("div",{className:"space-y-4",children:m.length>0?m.map(s=>e.jsx(E,{material:s,convertToDownloadLink:y,getSubjectById:n},s.id)):e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(D,{size:32,className:"mx-auto mb-4 text-white/30"}),e.jsx("div",{className:"font-semibold text-white mb-2",children:"No materials found"}),e.jsx("div",{className:"text-sm text-zinc-400",children:"Try adjusting your search or filter criteria"})]})})]}):e.jsxs("div",{className:"p-5 pt-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("div",{className:"h-8 bg-zinc-800 rounded w-48 mx-auto mb-2 animate-pulse"}),e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-80 mx-auto animate-pulse"})]}),e.jsx("div",{className:"glass-card p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1 h-10 bg-zinc-800 rounded-xl animate-pulse"}),e.jsx("div",{className:"w-12 h-10 bg-zinc-800 rounded-xl animate-pulse"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-10 bg-zinc-800 rounded-xl animate-pulse"}),e.jsx("div",{className:"h-10 bg-zinc-800 rounded-xl animate-pulse"})]})]})}),e.jsx("div",{className:"mb-2 h-4 bg-zinc-800 rounded w-64 animate-pulse"}),e.jsx("div",{className:"space-y-4",children:[...Array(8)].map((s,t)=>e.jsx(w,{},t))})]})}export{q as default};
